<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Model Collector ‚Äî Autosync (Verified)</title>
  <style>
    :root{--bg:#0f1220;--card:#171a2b;--muted:#9aa3b2;--text:#e6e9f0;--accent:#7c9cff;--ok:#21c7a8;--warn:#ffbf69;--danger:#ff6b6b;--border:#262b45;--shadow:0 6px 24px rgba(0,0,0,.35);--radius:14px}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial;background:radial-gradient(1200px 800px at 20% -10%,#1a1f3a 0,rgba(26,31,58,0) 60%),var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:20;backdrop-filter:blur(8px);background:linear-gradient(180deg,rgba(15,18,32,.85),rgba(15,18,32,.6));border-bottom:1px solid var(--border)}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}
    .brand{display:flex;gap:10px;align-items:center;font-weight:700}.logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#7c9cff,#21c7a8);display:grid;place-items:center;color:#0b0e1a;font-weight:900}
    button,select,input[type="text"],input[type="url"],input[type="password"]{appearance:none;border:1px solid var(--border);background:linear-gradient(180deg,#1a1e33,#121527);color:var(--text);padding:10px 12px;border-radius:12px;box-shadow:var(--shadow);font-weight:600}
    button{cursor:pointer;transition:.15s transform ease,.2s border-color} button:hover{transform:translateY(-1px);border-color:#33406a}
    button.primary{background:linear-gradient(180deg,#2b3563,#1a2147);border-color:#3a4a86}
    .layout{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px} @media(max-width:900px){.layout{grid-template-columns:1fr}}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
    .row{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(3,1fr)} @media(max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}} @media(max-width:640px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:linear-gradient(180deg,#171a2b 0,#14182a 100%);box-shadow:var(--shadow);display:flex;flex-direction:column}
    .thumb{position:relative;aspect-ratio:4/3;background:#0e1222;overflow:hidden}.thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .title{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:12px}.links{display:flex;gap:8px;flex-wrap:wrap;margin:8px 12px}
    .meta,.tags{display:flex;gap:8px;flex-wrap:wrap;margin:0 12px 8px 12px}.chip{background:#22263b;color:#cbd3ff;font-size:12px;border:1px solid var(--border);padding:6px 10px;border-radius:999px}
    .foot{padding:12px;display:flex;gap:8px;border-top:1px solid var(--border);margin-top:auto}
    #editor{display:none;margin-top:16px} #editor.open{display:block}
    #toast{position:fixed;right:12px;bottom:12px;background:#11162a;color:#e6e9f0;border:1px solid var(--border);padding:10px 12px;border-radius:10px;font-size:13px;display:none;z-index:60}
    /* Cloud overlay */
    #cloudOverlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:100}
    #cloudOverlay.open{display:flex}
    #cloudPanel{width:min(720px,92vw);background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
    .status{font-size:13px;margin-top:6px}
    .status.ok{color:var(--ok)} .status.bad{color:var(--danger)} .status.wait{color:var(--warn)}
    .spinner{display:inline-block;width:14px;height:14px;border:2px solid #fff;border-right-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite; vertical-align:-2px; margin-right:6px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .muted{color:var(--muted); font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="wrap toolbar">
      <div class="brand"><div class="logo">MC</div><div><div>Model Collector</div><div class="small">Autosync (Verified)</div></div></div>
      <div class="flex">
        <button class="primary" id="btnToggleEditor" type="button">‚ûï Dodaj modelkƒô</button>
        <button id="btnExport" type="button">‚¨áÔ∏è Eksport</button>
        <button id="btnImport" type="button">‚¨ÜÔ∏è Import</button><input type="file" id="importFile" accept=".json" style="display:none" />
        <button class="ghost" id="btnCloud" type="button">‚òÅÔ∏è Chmura</button>
        <button class="ghost" id="btnWipe" type="button">üóëÔ∏è Wyczy≈õƒá</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="layout">
      <aside class="panel">
        <h2>Filtry</h2>
        <div class="row">
          <div><label for="q">Szukaj</label><input id="q" type="text" placeholder="np. nick" /></div>
          <div><label for="platform">Platforma</label><select id="platform"><option value="">Dowolna</option><option value="onlyfans">OnlyFans</option><option value="chaturbate">Chaturbate</option></select></div>
        </div>
        <div class="row">
          <div><label for="hair">W≈Çosy</label><select id="hair"><option value="">Dowolne</option><option value="blonde">Blonde</option><option value="brunette">Brunette</option><option value="black">Black</option><option value="redhead">Redhead</option><option value="other">Other</option></select></div>
          <div><label for="body">Sylwetka</label><select id="body"><option value="">Dowolna</option><option value="slim">Slim</option><option value="fit">Fit</option><option value="curvy">Curvy</option></select></div>
        </div>
        <div class="row">
          <div><label for="eth">Pochodzenie</label><select id="eth"><option value="">Dowolne</option><option value="latina">Latina</option><option value="asian">Asian</option><option value="other">Other</option></select></div>
          <div class="right" id="countInfo" style="align-self:end">0 pozycji</div>
        </div>
      </aside>

      <section>
        <div id="grid" class="grid"></div>
        <div id="empty" class="panel" style="display:none;text-align:center">Brak wynik√≥w</div>

        <div id="editor" class="panel">
          <h2 id="editorTitle">Dodaj / Edytuj modelkƒô</h2>
          <div class="row">
            <div><label>Nazwa / nick</label><input id="f_name" type="text" /></div>
            <div><label>Obraz (URL)</label><input id="f_imgurl" type="url" placeholder="https://..." /></div>
          </div>
          <div class="row">
            <div><label>OnlyFans</label><input id="f_onlyfans" type="url" placeholder="https://onlyfans.com/..." /></div>
            <div><label>Chaturbate</label><input id="f_chaturbate" type="url" placeholder="https://chaturbate.com/..." /></div>
          </div>
          <div class="row">
            <div><label>SimpCity</label><input id="f_simpcity" type="url" placeholder="https://simpcity..." /></div>
            <div><label>Instagram</label><input id="f_insta" type="url" placeholder="https://instagram.com/..." /></div>
          </div>
          <div class="row">
            <div><label>Twitter/X</label><input id="f_twitter" type="url" placeholder="https://twitter.com/..." /></div>
            <div><label>Platforma</label><select id="f_platform"><option value="onlyfans">OnlyFans</option><option value="chaturbate">Chaturbate</option><option value="both">Obie</option></select></div>
          </div>
          <div class="flex" style="margin-top:10px">
            <button id="btnSave" class="primary" type="button">üíæ Zapisz</button>
            <button id="btnCancel" type="button">Anuluj</button>
            <div class="right small" id="saveInfo"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Cloud Overlay -->
  <div id="cloudOverlay">
    <div id="cloudPanel">
      <h3>‚òÅÔ∏è GitHub Sync</h3>
      <div class="panel" style="margin-top:8px">
        <div class="row">
          <div><label>Owner</label><input id="ghOwner" type="text" placeholder="notsupas"></div>
          <div><label>Repo</label><input id="ghRepo" type="text" placeholder="some"></div>
        </div>
        <div class="row">
          <div><label>Plik</label><input id="ghPath" type="text" value="models.json"></div>
          <div><label>Branch</label><input id="ghBranch" type="text" value="main"></div>
        </div>
        <div class="row">
          <div><label>Token (PAT)</label><input id="ghToken" type="password" placeholder="ghp_..."></div>
          <div style="display:flex;align-items:center;gap:8px">
            <input id="ghAuto" type="checkbox" />
            <label for="ghAuto">Auto-zapis po zmianach</label>
          </div>
        </div>

        <div class="row" style="margin-top:6px">
          <button id="btnCloudSave" type="button">‚è´ Zapisz teraz</button>
          <button id="btnCloudLoad" type="button">‚è¨ Pobierz</button>
          <button id="btnCloudClose" type="button" class="right">Zamknij</button>
        </div>
        <div id="cloudStatus" class="status muted">Gotowy.</div>
        <div class="muted" style="margin-top:4px">Po zapisie nastƒôpuje weryfikacja (czytamy ≈õwie≈ºo z <code>raw.githubusercontent.com</code>).</div>
      </div>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    const $=s=>document.querySelector(s);
    function toast(m){const t=$('#toast');t.textContent=m;t.style.display='block';setTimeout(()=>t.style.display='none',2600)}
    function b64(s){return btoa(unescape(encodeURIComponent(s)))}

    let state={models:[], cloud:{owner:'',repo:'',path:'models.json',branch:'main',token:'',auto:false,lastPullUrl:''}};

    function saveLocal(){ localStorage.setItem('mc_models_v1', JSON.stringify(state.models)); localStorage.setItem('mc_cloud_v4', JSON.stringify(state.cloud)); }
    function loadLocal(){ try{state.models=JSON.parse(localStorage.getItem('mc_models_v1'))||[]}catch{} try{Object.assign(state.cloud, JSON.parse(localStorage.getItem('mc_cloud_v4'))||{})}catch{} }

    function render(){
      const grid=$('#grid'),empty=$('#empty'); grid.innerHTML='';
      $('#countInfo').textContent=state.models.length+' '+(state.models.length===1?'pozycja':'pozycji');
      if(!state.models.length){ empty.style.display='block'; return } else empty.style.display='none';
      state.models.forEach(m=>{
        const card=document.createElement('div'); card.className='card';
        const th=document.createElement('div'); th.className='thumb';
        const img=document.createElement('img'); img.src=m.image||''; img.alt=m.name||'‚Äî'; img.loading='lazy'; th.appendChild(img);
        const title=document.createElement('div'); title.className='title';
        const h3=document.createElement('h3'); h3.style.margin='0'; h3.textContent=m.name||'‚Äî';
        const plat=document.createElement('span'); plat.className='chip'; plat.textContent=m.platform||'‚Äî';
        title.append(h3,plat);
        const links=document.createElement('div'); links.className='links';
        function a(lbl,url){ if(!url) return; const el=document.createElement('a'); el.textContent=lbl; el.href=url; el.target='_blank'; el.rel='noopener'; links.appendChild(el) }
        a('OnlyFans',m.onlyfans); a('Chaturbate',m.chaturbate); a('SimpCity',m.simpcity); a('Instagram',m.insta); a('Twitter/X',m.twitter);
        const foot=document.createElement('div'); foot.className='foot';
        const ed=document.createElement('button'); ed.textContent='‚úèÔ∏è Edytuj'; ed.onclick=()=>openEditor(m.id);
        const del=document.createElement('button'); del.textContent='üóëÔ∏è Usu≈Ñ'; del.onclick=()=>removeModel(m.id);
        foot.append(ed,del);
        card.append(th,title,links,foot); grid.appendChild(card);
      });
    }

    function openEditor(id){
      state.editId=id||null; $('#editor').classList.add('open'); $('#editorTitle').textContent = id ? 'Edytuj modelkƒô' : 'Dodaj modelkƒô'; $('#saveInfo').textContent='';
      const m = state.models.find(x=>x.id===id)||{};
      $('#f_name').value=m.name||''; $('#f_imgurl').value=m.image||''; $('#f_onlyfans').value=m.onlyfans||''; $('#f_chaturbate').value=m.chaturbate||'';
      $('#f_simpcity').value=m.simpcity||''; $('#f_insta').value=m.insta||''; $('#f_twitter').value=m.twitter||''; $('#f_platform').value=m.platform||'onlyfans';
      window.scrollTo({top:0,behavior:'smooth'});
    }
    function onSave(){
      const p={name:$('#f_name').value.trim(), image:$('#f_imgurl').value.trim(), onlyfans:$('#f_onlyfans').value.trim(),
        chaturbate:$('#f_chaturbate').value.trim(), simpcity:$('#f_simpcity').value.trim(), insta:$('#f_insta').value.trim(), twitter:$('#f_twitter').value.trim(),
        platform:$('#f_platform').value, createdAt:Date.now()};
      if(!p.name){toast('Podaj nazwƒô');return}
      if(state.editId){ const i=state.models.findIndex(m=>m.id===state.editId); if(i>=0) state.models[i]=Object.assign({}, state.models[i], p); }
      else{ p.id='id-'+Date.now()+'-'+Math.random().toString(16).slice(2); state.models.unshift(p); }
      saveLocal(); $('#editor').classList.remove('open'); render(); if(state.cloud.auto) cloudSave();
    }
    function removeModel(id){
      if(!confirm('UsunƒÖƒá tƒô pozycjƒô?')) return;
      state.models = state.models.filter(m=>m.id!==id);
      saveLocal(); render(); if(state.cloud.auto) cloudSave();
    }

    // Toolbar
    $('#btnToggleEditor').addEventListener('click',()=>openEditor(null));
    $('#btnSave').addEventListener('click',onSave);
    $('#btnCancel').addEventListener('click',()=>$('#editor').classList.remove('open'));
    $('#btnExport').addEventListener('click',()=>{
      const data={models:state.models,tags:['pawg','milf'],tagSets:{Imported:['pawg']},sort:{key:'created',dir:'desc'},view:'grid'};
      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='models.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1500);
    });
    $('#btnImport').addEventListener('click',()=>$('#importFile').click());
    $('#importFile').addEventListener('change',e=>{const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{const j=JSON.parse(r.result); if(Array.isArray(j.models)) state.models=j.models; saveLocal(); render(); toast('Zaimportowano ‚úÖ'); if(state.cloud.auto) cloudSave(); }catch{ toast('B≈ÇƒÖd importu') } }; r.readAsText(f); e.target.value=''; });
    $('#btnWipe').addEventListener('click',()=>{ if(!confirm('Wyczy≈õciƒá lokalne dane?')) return; localStorage.removeItem('mc_models_v1'); state.models=[]; render(); });

    // Cloud overlay open/close
    $('#btnCloud').addEventListener('click',()=>{ $('#ghOwner').value=state.cloud.owner||''; $('#ghRepo').value=state.cloud.repo||''; $('#ghPath').value=state.cloud.path||'models.json'; $('#ghBranch').value=state.cloud.branch||'main'; $('#ghToken').value=state.cloud.token||''; $('#ghAuto').checked=!!state.cloud.auto; $('#cloudOverlay').classList.add('open'); $('#cloudStatus').textContent='Gotowy.'; $('#cloudStatus').className='status muted'; });
    $('#btnCloudClose').addEventListener('click',()=>$('#cloudOverlay').classList.remove('open'));
    $('#ghAuto').addEventListener('change',e=>{ state.cloud.auto=!!e.target.checked; saveLocal(); });

    async function verifyReadback(owner,repo,path,branch){
      const url=`https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}`;
      try{
        const res=await fetch(url+'?t='+(Date.now()));
        const text=await res.text();
        try{
          const j=JSON.parse(text);
          const n = Array.isArray(j.models)? j.models.length : 0;
          $('#cloudStatus').innerHTML = `<span class="status ok">‚úÖ Zapis potwierdzony ‚Äî pobrano ${n} modeli</span> <a class="muted" target="_blank" rel="noopener" href="${url}">(podglƒÖd JSON)</a>`;
          return true;
        }catch(e){
          $('#cloudStatus').innerHTML = `<span class="status bad">‚ö†Ô∏è Zapis poszed≈Ç, ale odpowied≈∫ RAW nie jest JSON ‚Äî sprawd≈∫ plik.</span> <a class="muted" target="_blank" rel="noopener" href="${url}">(otw√≥rz)</a>`;
          return false;
        }
      }catch(e){
        $('#cloudStatus').textContent='‚ùå Nie uda≈Ço siƒô potwierdziƒá odczytu: '+e.message;
        $('#cloudStatus').className='status bad';
        return false;
      }
    }

    async function cloudSave(){
      const owner=$('#ghOwner').value.trim()||state.cloud.owner;
      const repo=$('#ghRepo').value.trim()||state.cloud.repo;
      const path=$('#ghPath').value.trim()||state.cloud.path||'models.json';
      const branch=$('#ghBranch').value.trim()||state.cloud.branch||'main';
      const token=$('#ghToken').value.trim()||state.cloud.token;
      if(!owner||!repo||!path||!branch||!token){ $('#cloudStatus').textContent='Uzupe≈Çnij owner/repo/path/branch/token'; $('#cloudStatus').className='status bad'; return; }

      // Persist fields
      state.cloud={owner,repo,path,branch,token,auto:$('#ghAuto').checked,lastPullUrl:`https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}`};
      saveLocal();

      const btn=$('#btnCloudSave'); btn.disabled=true; btn.textContent='‚è≥ Zapisujƒô‚Ä¶';
      $('#cloudStatus').innerHTML='<span class="spinner"></span><span class="status wait">Wysy≈Çam commit do GitHub‚Ä¶</span>';

      // Get SHA (exists?)
      async function getSha(){
        const url=`https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`;
        const headers={'Accept':'application/vnd.github+json','Authorization':'token '+token};
        const r=await fetch(url,{headers}); if(r.status===404) return null; if(!r.ok) throw new Error('getSha HTTP '+r.status); const j=await r.json(); return j.sha;
      }

      try{
        const sha = await getSha();
        const api=`https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
        const data={models:state.models, tags:['pawg','milf'], tagSets:{Imported:['pawg']}, sort:{key:'created',dir:'desc'}, view:'grid'};
        const body={message:'MC autosave', content:b64(JSON.stringify(data,null,2)), branch, sha: sha || undefined};
        const res=await fetch(api,{method:'PUT', headers:{'Accept':'application/vnd.github+json','Content-Type':'application/json','Authorization':'token '+token}, body: JSON.stringify(body)});
        const text=await res.text();
        if(!res.ok){ $('#cloudStatus').innerHTML=`<span class="status bad">‚ùå B≈ÇƒÖd HTTP ${res.status}</span><div class="muted">${text.replace(/</g,'&lt;')}</div>`; btn.disabled=false; btn.textContent='‚è´ Zapisz teraz'; return; }
        // Success ‚Äî verify by reading back
        $('#cloudStatus').innerHTML='<span class="spinner"></span><span class="status wait">Zapis OK ‚Äî weryfikujƒô odczyt‚Ä¶</span>';
        const ok = await verifyReadback(owner,repo,path,branch);
        btn.disabled=false; btn.textContent='‚è´ Zapisz teraz';
        if(ok) setTimeout(()=>$('#cloudOverlay').classList.remove('open'), 800); // auto-close after confirm
      }catch(e){
        $('#cloudStatus').textContent='‚ùå WyjƒÖtek: '+e.message; $('#cloudStatus').className='status bad'; btn.disabled=false; btn.textContent='‚è´ Zapisz teraz';
      }
    }

    async function cloudLoad(){
      const owner=$('#ghOwner').value.trim()||state.cloud.owner;
      const repo=$('#ghRepo').value.trim()||state.cloud.repo;
      const path=$('#ghPath').value.trim()||state.cloud.path||'models.json';
      const branch=$('#ghBranch').value.trim()||state.cloud.branch||'main';
      const url=`https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}`;
      $('#cloudStatus').innerHTML='<span class="spinner"></span><span class="status wait">Pobieram z GitHub‚Ä¶</span>';
      try{
        const res=await fetch(url+'?t='+(Date.now()));
        const j=await res.json();
        if(Array.isArray(j.models)){ state.models=j.models; saveLocal(); render(); $('#cloudStatus').innerHTML=`<span class="status ok">‚úÖ Pobrano ${j.models.length} modeli</span> <a class="muted" target="_blank" rel="noopener" href="${url}">(podglƒÖd JSON)</a>`; }
        else { $('#cloudStatus').textContent='Plik nie zawiera pola models'; $('#cloudStatus').className='status bad'; }
      }catch(e){
        $('#cloudStatus').textContent='‚ùå Nie uda≈Ço siƒô pobraƒá: '+e.message; $('#cloudStatus').className='status bad';
      }
    }

    // Bind
    $('#btnCloud').addEventListener('click',()=>$('#cloudOverlay').classList.add('open'));
    $('#btnCloudClose').addEventListener('click',()=>$('#cloudOverlay').classList.remove('open'));
    $('#btnCloudSave').addEventListener('click', cloudSave);
    $('#btnCloudLoad').addEventListener('click', cloudLoad);

    // Filters (basic)
    $('#q').addEventListener('input',e=>render());

    // Init
    loadLocal(); render();
  </script>
</body>
</html>
